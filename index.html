<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PUKERIMU Weather Widget</title>
  <style>
    body { background: #0a2239; color: #fff; font-family: sans-serif; display: flex; justify-content: center; padding: 40px; }
    #widget { background: #18314f; border-radius: 16px; box-shadow: 0 4px 24px rgba(0,0,0,0.25); padding: 28px; width: 360px; }
    h2 { margin: 0 0 16px 0; text-align: center; }
    .row { display: flex; justify-content: space-between; margin: 10px 0; font-size: 1.12em; }
    .label { color: #a7bed3; }
    .value { color: #fff; font-weight: bold; }
    .icon { width: 38px; height: 38px; vertical-align: middle; margin-right: 12px; }
    .condition-row { display: flex; align-items: center; }
  </style>
</head>
<body>
  <div id="widget">
    <h2 id="station-title">PUKERIMU</h2>
    <div class="row"><span class="label">Time:</span> <span class="value" id="time">--</span></div>
    <div class="row"><span class="label">Temperature:</span> <span class="value" id="temp">-- 째C</span></div>
    <div class="row"><span class="label">Feels Like:</span> <span class="value" id="feels">-- 째C</span></div>
    <div class="row"><span class="label">Humidity:</span> <span class="value" id="humidity">-- %</span></div>
    <div class="row"><span class="label">Wind:</span> <span class="value" id="wind">-- km/h</span></div>
    <div class="row"><span class="label">Direction:</span> <span class="value" id="winddir">--</span></div>
    <div class="row"><span class="label">Pressure:</span> <span class="value" id="pressure">-- hPa</span></div>
    <div class="row"><span class="label">Precip Rate:</span> <span class="value" id="precip">-- mm/hr</span></div>
    <div class="row condition-row">
      <span class="label">Condition:</span>
      <span class="value">
        <img id="wxicon" class="icon" src="" alt="" style="display:none;">
        <span id="condition">--</span>
      </span>
    </div>
    <div style="text-align:center; margin-top:12px; font-size:0.9em; color:#7fa8d3;" id="location">--</div>
  </div>

  <script>
    const STATION_ID = "pws_pukerimu";
    const API_URL = `https://data.api.xweather.com/conditions/${STATION_ID}?format=json&plimit=1&filter=1min&client_id=U8feQfLlcEfcXDfsWZs4C&client_secret=HvIaM6HOkFmlJ8ywHPNSudj9txzpyuP7gJh2eDvq`;

    function pad(n){ return n<10 ? '0'+n : n }
    function displayData(data) {
      const p = data.response?.[0]?.periods?.[0];
      const place = data.response?.[0]?.place;
      if (!p) return;

      const dt = new Date(p.dateTimeISO);
      document.getElementById('time').textContent = `${pad(dt.getHours())}:${pad(dt.getMinutes())}, ${pad(dt.getDate())}-${pad(dt.getMonth()+1)}-${dt.getFullYear()}`;

      document.getElementById('temp').textContent = p.tempC != null ? p.tempC.toFixed(1) + " 째C" : "--";
      document.getElementById('feels').textContent = p.feelslikeC != null ? p.feelslikeC.toFixed(1) + " 째C" : "--";
      document.getElementById('humidity').textContent = p.humidity != null ? p.humidity + "%" : "--";
      document.getElementById('wind').textContent = p.windSpeedKPH != null ? p.windSpeedKPH.toFixed(1) + " km/h" : "--";
      document.getElementById('winddir').textContent = p.windDir || "--";
      document.getElementById('pressure').textContent = p.pressureMB != null ? p.pressureMB + " hPa" : "--";
      document.getElementById('precip').textContent = p.precipRateMM != null ? p.precipRateMM + " mm/hr" : "--";
      document.getElementById('condition').textContent = p.weatherPrimary || p.weather || "--";

      if (p.icon) {
        const img = document.getElementById('wxicon');
        img.src = `https://cdn.aerisapi.com/wxblox/icons/${p.icon}`;
        img.alt = p.weather;
        img.style.display = "inline";
      }

      document.getElementById('location').textContent = place.name + ", " + place.country.toUpperCase();
      document.getElementById('station-title').textContent = STATION_ID.replace("pws_", "").toUpperCase();
    }

    async function refresh() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        displayData(data);
      } catch (e) {
        console.error(e);
      }
    }

    refresh();
    setInterval(refresh, 60 * 1000);
  </script>
</body>
</html>
